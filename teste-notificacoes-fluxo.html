<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Fluxo de Notifica√ß√µes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 24px;
            text-align: center;
            font-size: 24px;
        }

        .section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        h2 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-box {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
            font-family: 'Courier New', monospace;
        }

        .status-box.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .status-box.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .status-box.warning {
            background: #fff3e0;
            color: #e65100;
            border-left: 4px solid #ff9800;
        }

        .status-box.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .button-group button {
            margin-bottom: 0;
        }

        .log {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 4px;
            border-radius: 3px;
        }

        .log-entry.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        .log-entry.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .log-entry.error {
            background: #ffebee;
            color: #c62828;
        }

        .log-entry.warning {
            background: #fff3e0;
            color: #e65100;
        }

        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 12px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .indicator.success {
            background: #4caf50;
        }

        .indicator.error {
            background: #f44336;
        }

        .indicator.warning {
            background: #ff9800;
        }

        @media (max-width: 600px) {
            .button-group {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî Teste de Notifica√ß√µes</h1>

        <!-- Se√ß√£o: Status do Sistema -->
        <div class="section">
            <h2><span class="indicator error" id="indicator-notificacoes"></span>Status do Sistema</h2>
            <div class="status-box info" id="status-notificacoes">Carregando...</div>
            <div class="status-box info" id="status-permissao">Verificando permiss√£o...</div>
            <div class="status-box info" id="status-cache">Cache vazio</div>
        </div>

        <!-- Se√ß√£o: Permiss√µes -->
        <div class="section">
            <h2>üîê Permiss√µes</h2>
            <div class="button-group">
                <button onclick="pedirPermissao()">üìç Pedir Permiss√£o</button>
                <button onclick="verificarPermissao()">üîç Verificar</button>
            </div>
        </div>

        <!-- Se√ß√£o: Testar Notifica√ß√£o Duplicada -->
        <div class="section">
            <h2>üß™ Teste de Duplicatas</h2>
            <label>ID da Mensagem (para teste):</label>
            <input type="text" id="msgId" placeholder="Ex: 12345" value="12345">
            
            <label>T√≠tulo da Notifica√ß√£o:</label>
            <input type="text" id="titulo" placeholder="Ex: ‚öΩ +2.5 GOLS - Flamengo vs Vasco" value="‚öΩ +2.5 GOLS - Flamengo vs Vasco">
            
            <div class="button-group">
                <button onclick="testarNotificacao1()">Enviar 1¬™ vez</button>
                <button onclick="testarNotificacao2()">Enviar novamente (3s)</button>
            </div>
            <div class="status-box warning">
                Se a 2¬™ notifica√ß√£o aparecer em 3 segundos, o sistema est√° funcionando corretamente.
                Se n√£o aparecer, h√° um problema de duplicatas.
            </div>
        </div>

        <!-- Se√ß√£o: Simular Mensagens -->
        <div class="section">
            <h2>üì® Simular Mensagens do Bot</h2>
            <label>Tipo de Aposta:</label>
            <select id="tipoAposta">
                <option value="gols">‚öΩ GOLS</option>
                <option value="cantos">üö© CANTOS</option>
            </select>
            
            <label>Times:</label>
            <input type="text" id="times" placeholder="Ex: Flamengo vs Vasco" value="Flamengo vs Vasco">
            
            <label>OVER/UNDER:</label>
            <input type="text" id="overUnder" placeholder="Ex: +2.5" value="+2.5">
            
            <div class="button-group">
                <button onclick="simularMensagem1()">Mensagem 1</button>
                <button onclick="simularMensagem2()">Mensagem 2</button>
            </div>
        </div>

        <!-- Se√ß√£o: Verificar Cache -->
        <div class="section">
            <h2>üíæ Cache de Notifica√ß√µes</h2>
            <div class="button-group">
                <button onclick="verificarCache()">Verificar Cache</button>
                <button onclick="limparCache()">Limpar Cache</button>
            </div>
        </div>

        <!-- Se√ß√£o: Log -->
        <div class="section">
            <h2>üìã Log de Testes</h2>
            <div class="log" id="log"></div>
            <button onclick="limparLog()" style="margin-top: 12px;">Limpar Log</button>
        </div>
    </div>

    <script>
        // Vari√°veis globais para rastrear estado
        let testLog = [];

        function log(mensagem, tipo = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const entry = `[${timestamp}] ${mensagem}`;
            testLog.push({ msg: entry, tipo });

            const logEl = document.getElementById('log');
            const entryEl = document.createElement('div');
            entryEl.className = `log-entry ${tipo}`;
            entryEl.textContent = entry;
            logEl.appendChild(entryEl);
            logEl.scrollTop = logEl.scrollHeight;

            console.log(entry);
        }

        function limparLog() {
            testLog = [];
            document.getElementById('log').innerHTML = '';
            log('Log limpo', 'info');
        }

        function atualizarStatus() {
            // Status do NotificacoesSistema
            if (typeof NotificacoesSistema !== 'undefined') {
                document.getElementById('status-notificacoes').innerHTML = 
                    '<span class="indicator success"></span>NotificacoesSistema: ‚úÖ Carregado';
                document.getElementById('indicator-notificacoes').className = 'indicator success';
            } else {
                document.getElementById('status-notificacoes').innerHTML = 
                    '<span class="indicator error"></span>NotificacoesSistema: ‚ùå N√£o carregado';
                document.getElementById('indicator-notificacoes').className = 'indicator error';
            }

            // Permiss√£o
            if ('Notification' in window) {
                const perm = Notification.permission;
                const status = perm === 'granted' ? '‚úÖ Concedida' : perm === 'denied' ? '‚ùå Negada' : '‚è≥ Padr√£o';
                document.getElementById('status-permissao').innerHTML = 
                    `<span class="indicator ${perm === 'granted' ? 'success' : perm === 'denied' ? 'error' : 'warning'}"></span>Permiss√£o: ${status}`;
            }

            // Cache
            if (typeof NotificacoesSistema !== 'undefined') {
                const cacheSize = NotificacoesSistema.ultimasNotificacoes.size;
                document.getElementById('status-cache').innerHTML = 
                    `Cache de duplicatas: ${cacheSize} entrada(s)`;
            }
        }

        function pedirPermissao() {
            log('üîê Pedindo permiss√£o de notifica√ß√µes...', 'info');
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    log(`Resultado: ${permission}`, permission === 'granted' ? 'success' : 'error');
                    atualizarStatus();
                });
            } else {
                log('‚ùå Navegador n√£o suporta Web Notifications', 'error');
            }
        }

        function verificarPermissao() {
            log('üîç Verificando permiss√£o...', 'info');
            if ('Notification' in window) {
                const perm = Notification.permission;
                log(`Permiss√£o atual: ${perm}`, perm === 'granted' ? 'success' : 'warning');
            } else {
                log('‚ùå Navegador n√£o suporta Web Notifications', 'error');
            }
        }

        function testarNotificacao1() {
            const msgId = document.getElementById('msgId').value || '12345';
            const titulo = document.getElementById('titulo').value || '‚öΩ GOLS';
            
            log(`üì§ Enviando 1¬™ notifica√ß√£o (ID: ${msgId})`, 'info');
            
            if (typeof NotificacoesSistema !== 'undefined' && NotificacoesSistema.notificarNovaMensagem) {
                NotificacoesSistema.notificarNovaMensagem({
                    id: msgId,
                    titulo: titulo,
                    text: titulo,
                    time_1: 'Time A',
                    time_2: 'Time B',
                    tipo_aposta: 'gols'
                });
                log('‚úÖ Notifica√ß√£o enviada (1¬™)', 'success');
            } else {
                log('‚ùå NotificacoesSistema n√£o carregado', 'error');
            }
        }

        function testarNotificacao2() {
            const msgId = document.getElementById('msgId').value || '12345';
            const titulo = document.getElementById('titulo').value || '‚öΩ GOLS';
            
            setTimeout(() => {
                log(`üì§ Enviando 2¬™ notifica√ß√£o (ID: ${msgId})`, 'info');
                
                if (typeof NotificacoesSistema !== 'undefined' && NotificacoesSistema.notificarNovaMensagem) {
                    NotificacoesSistema.notificarNovaMensagem({
                        id: msgId,
                        titulo: titulo,
                        text: titulo,
                        time_1: 'Time A',
                        time_2: 'Time B',
                        tipo_aposta: 'gols'
                    });
                    log('‚úÖ Notifica√ß√£o enviada (2¬™)', 'success');
                } else {
                    log('‚ùå NotificacoesSistema n√£o carregado', 'error');
                }
            }, 3000);
            
            log('‚è≥ Agendado para 3 segundos...', 'warning');
        }

        function simularMensagem1() {
            const tipo = document.getElementById('tipoAposta').value;
            const times = document.getElementById('times').value || 'Time A vs Time B';
            const overUnder = document.getElementById('overUnder').value || '+2.5';
            const msgId = Math.floor(Math.random() * 100000);
            
            const titulo = `${tipo === 'cantos' ? 'üö©' : '‚öΩ'} ${overUnder} ${tipo.toUpperCase()} - ${times}`;
            
            log(`üì® Simulando mensagem 1 (ID: ${msgId}): ${titulo}`, 'info');
            
            if (typeof NotificacoesSistema !== 'undefined' && NotificacoesSistema.notificarNovaMensagem) {
                NotificacoesSistema.notificarNovaMensagem({
                    id: msgId,
                    titulo: titulo,
                    text: titulo,
                    time_1: times.split(' vs ')[0],
                    time_2: times.split(' vs ')[1] || 'Time B',
                    tipo_aposta: tipo
                });
                log('‚úÖ Mensagem 1 enviada', 'success');
            }
        }

        function simularMensagem2() {
            const tipo = document.getElementById('tipoAposta').value;
            const times = document.getElementById('times').value || 'Time A vs Time B';
            const overUnder = document.getElementById('overUnder').value || '+2.5';
            const msgId = Math.floor(Math.random() * 100000);
            
            const titulo = `${tipo === 'cantos' ? 'üö©' : '‚öΩ'} ${overUnder} ${tipo.toUpperCase()} - ${times}`;
            
            log(`üì® Simulando mensagem 2 (ID: ${msgId}): ${titulo}`, 'info');
            
            if (typeof NotificacoesSistema !== 'undefined' && NotificacoesSistema.notificarNovaMensagem) {
                NotificacoesSistema.notificarNovaMensagem({
                    id: msgId,
                    titulo: titulo,
                    text: titulo,
                    time_1: times.split(' vs ')[0],
                    time_2: times.split(' vs ')[1] || 'Time B',
                    tipo_aposta: tipo
                });
                log('‚úÖ Mensagem 2 enviada', 'success');
            }
        }

        function verificarCache() {
            log('üîç Verificando cache de duplicatas...', 'info');
            
            if (typeof NotificacoesSistema !== 'undefined') {
                const cache = NotificacoesSistema.ultimasNotificacoes;
                log(`Tamanho do cache: ${cache.size}`, cache.size > 0 ? 'warning' : 'success');
                
                if (cache.size > 0) {
                    let idx = 1;
                    cache.forEach(item => {
                        log(`  ${idx}. ${item}`, 'info');
                        idx++;
                    });
                }
            } else {
                log('‚ùå NotificacoesSistema n√£o carregado', 'error');
            }
        }

        function limparCache() {
            log('üóëÔ∏è Limpando cache de duplicatas...', 'warning');
            
            if (typeof NotificacoesSistema !== 'undefined') {
                NotificacoesSistema.ultimasNotificacoes.clear();
                log('‚úÖ Cache limpo', 'success');
            } else {
                log('‚ùå NotificacoesSistema n√£o carregado', 'error');
            }
        }

        // Inicializar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina carregada', 'success');
            setTimeout(atualizarStatus, 1000);
        });

        // Auto-atualizar status a cada 2 segundos
        setInterval(atualizarStatus, 2000);
    </script>
</body>
</html>
