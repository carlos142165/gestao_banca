# ===========================================================================
# CONFIGURAÇÃO DE REWRITE E API
# ===========================================================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Permitir acesso direto aos arquivos PHP da pasta api sem redirecionamentos
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_FILENAME} ^/api/
    RewriteRule ^ - [L]
    
    # Desabilitar redirecionamentos para o webhook
    RewriteCond %{REQUEST_URI} ^/api/telegram-webhook\.php$
    RewriteRule ^ - [L]
    
    # Desabilitar redirecionamentos para carregar-mensagens-banco
    RewriteCond %{REQUEST_URI} ^/api/carregar-mensagens-banco\.php$
    RewriteRule ^ - [L]
</IfModule>

# ===========================================================================
# PWA E NOTIFICAÇÕES MOBILE
# ===========================================================================

<IfModule mod_mime.c>
    # Service Worker
    AddType application/javascript .js
    
    # Manifest
    AddType application/manifest+json .webmanifest
    AddType application/json .json
    
    # Imagens
    AddType image/jpeg .jpg .jpeg
    AddType image/png .png
</IfModule>

<IfModule mod_headers.c>
    # Service Worker - NUNCA cachear
    <FilesMatch "service-worker\.js$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
    
    # Manifest - cache curto
    <FilesMatch "manifest\.json$">
        Header set Cache-Control "public, max-age=3600"
    </FilesMatch>
    
    # Permitir notificações
    Header set Permissions-Policy "notifications=(*)"
    
    # X-Content-Type-Options
    Header set X-Content-Type-Options "nosniff"
</IfModule>

# Instruções para limpar cookies
# Remova os cookies do navegador para analisegb.com
