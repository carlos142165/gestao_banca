<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug - Admin IDs</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Rajdhani", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f8fafc;
        padding: 40px 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      .card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #667eea;
        margin-bottom: 30px;
      }
      h2 {
        color: #764ba2;
        margin: 20px 0 15px 0;
      }
      code {
        background: #e2e8f0;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
      }
      .output {
        background: #1e293b;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        margin: 15px 0;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 400px;
        overflow-y: auto;
      }
      button {
        padding: 10px 20px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        margin: 10px 5px 10px 0;
      }
      button:hover {
        background: #764ba2;
      }
      .success {
        background: #10b981;
      }
      .success:hover {
        background: #059669;
      }
      .erro {
        background: #ef4444;
      }
      .erro:hover {
        background: #dc2626;
      }
      .info-box {
        background: #dbeafe;
        border-left: 4px solid #0284c7;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
        color: #0c2d6b;
      }
      .test-result {
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 4px solid;
      }
      .test-result.ok {
        background: #d1fae5;
        border-left-color: #10b981;
        color: #065f46;
      }
      .test-result.erro {
        background: #fee2e2;
        border-left-color: #ef4444;
        color: #7f1d1d;
      }
      .test-result.info {
        background: #dbeafe;
        border-left-color: #0284c7;
        color: #0c2d6b;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>üêõ Debug - Sistema de Admin IDs</h1>

        <div class="info-box">
          <strong
            >‚ÑπÔ∏è Esta p√°gina diagnostica problemas com o sistema de admin
            IDs</strong
          >
        </div>

        <h2>Testes Dispon√≠veis</h2>
        <button onclick="testarSessao()" class="success">
          ‚úì Testar Sess√£o
        </button>
        <button onclick="testarArquivoJSON()" class="success">
          ‚úì Testar Arquivo JSON
        </button>
        <button onclick="testarAPI()" class="success">‚úì Testar API</button>
        <button onclick="testarTodos()" class="success">‚úì Testar Tudo</button>
        <button onclick="limparOutput()" class="erro">‚úï Limpar</button>

        <h2>Resultado dos Testes</h2>
        <div id="output" class="output">Aguardando testes...</div>
      </div>
    </div>

    <script>
      // Log com timestamp
      function log(msg, tipo = "info") {
        const output = document.getElementById("output");
        const timestamp = new Date().toLocaleTimeString("pt-BR");
        let prefix = "[INFO]";
        let color = "#64748b";

        if (tipo === "ok") {
          prefix = "‚úì [OK]";
          color = "#10b981";
        } else if (tipo === "erro") {
          prefix = "‚úó [ERRO]";
          color = "#ef4444";
        } else if (tipo === "aviso") {
          prefix = "‚ö† [AVISO]";
          color = "#f59e0b";
        }

        output.innerHTML += `\n${prefix} ${timestamp} - ${msg}`;
        output.scrollTop = output.scrollHeight;
      }

      function limparOutput() {
        document.getElementById("output").innerHTML =
          "Logs limpos. Execute um teste.";
      }

      // Testar Sess√£o
      async function testarSessao() {
        limparOutput();
        log("Iniciando teste de sess√£o...", "info");

        try {
          const response = await fetch("admin-ids-config.php?debug=sessao", {
            method: "POST",
            body: "acao=obter",
          });

          const text = await response.text();

          log("Status HTTP: " + response.status, response.ok ? "ok" : "erro");
          log("Response Type: " + response.headers.get("content-type"), "info");
          log("Response Body: " + text.substring(0, 200), "info");

          try {
            const data = JSON.parse(text);
            log("JSON V√°lido: Sim", "ok");
            log(
              "Sucesso: " + (data.success ? "Sim" : "N√£o"),
              data.success ? "ok" : "erro"
            );
            if (!data.success) {
              log("Mensagem de erro: " + data.mensagem, "erro");
            }
          } catch (e) {
            log("JSON V√°lido: N√£o - " + e.message, "erro");
          }
        } catch (error) {
          log("Erro na requisi√ß√£o: " + error.message, "erro");
        }
      }

      // Testar Arquivo JSON
      async function testarArquivoJSON() {
        limparOutput();
        log("Iniciando teste de arquivo JSON...", "info");

        try {
          const response = await fetch("dados/admin_ids.json");

          if (!response.ok) {
            log("Arquivo n√£o encontrado (404)", "erro");
            return;
          }

          const data = await response.json();
          log("‚úì Arquivo JSON encontrado", "ok");
          log("Conte√∫do: " + JSON.stringify(data), "info");
          log(
            "Total de IDs: " +
              (Array.isArray(data) ? data.length : "ERRO - n√£o √© array"),
            "ok"
          );

          if (Array.isArray(data)) {
            for (const id of data) {
              log("  - ID: " + id, "info");
            }
          }
        } catch (error) {
          log("Erro ao ler JSON: " + error.message, "erro");
        }
      }

      // Testar API Completa
      async function testarAPI() {
        limparOutput();
        log("Iniciando teste de API...", "info");
        log("Endpoint: admin-ids-config.php", "info");

        // Teste 1: Obter IDs
        log("\n--- Teste 1: Obter IDs ---", "info");
        try {
          const response = await fetch("admin-ids-config.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "acao=obter",
          });

          const data = await response.json();

          if (data.success) {
            log("Status: OK", "ok");
            log("IDs carregados: " + JSON.stringify(data.ids), "ok");
            log("Total: " + data.total, "info");
          } else {
            log("Status: ERRO", "erro");
            log("Mensagem: " + data.mensagem, "erro");
          }
        } catch (error) {
          log("Erro na requisi√ß√£o: " + error.message, "erro");
        }
      }

      // Testar Tudo
      async function testarTodos() {
        await testarSessao();
        log("\n\n--- Passando para pr√≥ximo teste ---\n", "info");
        await testarArquivoJSON();
        log("\n\n--- Passando para pr√≥ximo teste ---\n", "info");
        await testarAPI();
      }

      // Auto-test ao carregar
      window.addEventListener("load", () => {
        log("P√°gina carregada. Voc√™ pode executar os testes acima.", "info");
      });
    </script>
  </body>
</html>
