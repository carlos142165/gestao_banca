<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste R√°pido - Valida√ß√£o de Mentores</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        padding: 20px;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 20px;
      }
      .test-box {
        background: #f9f9f9;
        padding: 15px;
        margin: 15px 0;
        border-left: 4px solid #667eea;
        border-radius: 5px;
      }
      button {
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        margin: 10px 0;
      }
      button:hover {
        background: #5568d3;
      }
      .resultado {
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        font-weight: bold;
      }
      .sucesso {
        background: #d4edda;
        color: #155724;
      }
      .erro {
        background: #f8d7da;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }
      pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        margin-top: 10px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Teste R√°pido - Valida√ß√£o de Mentores</h1>

      <div class="test-box">
        <h3>Teste 1: Verificar API de Limite</h3>
        <p>Verifica se a API est√° respondendo corretamente</p>
        <button onclick="testarApi()">Testar API</button>
        <div id="resultado-api" class="resultado" style="display: none"></div>
      </div>

      <div class="test-box">
        <h3>Teste 2: Verificar Plano do Usu√°rio</h3>
        <p>Verifica qual √© o plano atual do usu√°rio logado</p>
        <button onclick="testarPlano()">Testar Plano</button>
        <div id="resultado-plano" class="resultado" style="display: none"></div>
      </div>

      <div class="test-box">
        <h3>Teste 3: Verificar Mentores Cadastrados</h3>
        <p>Verifica quantos mentores j√° est√£o cadastrados</p>
        <button onclick="testarMentores()">Contar Mentores</button>
        <div
          id="resultado-mentores"
          class="resultado"
          style="display: none"
        ></div>
      </div>

      <div class="test-box">
        <h3>Teste 4: Verificar Listeners do Form</h3>
        <p>Verifica se o form-mentor-novo tem listeners corretos</p>
        <button onclick="testarListeners()">Verificar Listeners</button>
        <div
          id="resultado-listeners"
          class="resultado"
          style="display: none"
        ></div>
      </div>
    </div>

    <script>
      async function testarApi() {
        const div = document.getElementById("resultado-api");
        div.style.display = "block";
        div.className = "resultado info";
        div.innerHTML = "‚è≥ Testando...";

        try {
          const response = await fetch(
            "verificar-limite-debug.php?acao=mentor"
          );
          const data = await response.json();

          if (data.success && data.pode_prosseguir === false) {
            div.className = "resultado sucesso";
            div.innerHTML = `‚úÖ API FUNCIONANDO CORRETAMENTE<br>Limite est√° sendo validado corretamente`;
          } else if (data.success && data.pode_prosseguir === true) {
            div.className = "resultado info";
            div.innerHTML = `‚ÑπÔ∏è API RESPONDENDO<br>Usu√°rio pode adicionar mentor (limite n√£o atingido)`;
          } else {
            div.className = "resultado erro";
            div.innerHTML = `‚ùå ERRO NA API: ${
              data.mensagem || "Desconhecido"
            }`;
          }

          console.log("Resposta da API:", data);
          if (data.debug) {
            console.log("Debug:", data.debug);
          }
        } catch (error) {
          div.className = "resultado erro";
          div.innerHTML = `‚ùå Erro na requisi√ß√£o: ${error.message}`;
        }
      }

      async function testarPlano() {
        const div = document.getElementById("resultado-plano");
        div.style.display = "block";
        div.className = "resultado info";
        div.innerHTML = "‚è≥ Carregando...";

        try {
          const response = await fetch("obter-plano-usuario.php");
          const data = await response.json();

          if (data.success) {
            div.className = "resultado sucesso";
            div.innerHTML = `‚úÖ Plano: <strong>${data.plano}</strong><br>
                    Limite de mentores: ${data.limite_mentores}<br>
                    Mentores cadastrados: ${data.mentores_cadastrados}`;
          } else {
            div.className = "resultado erro";
            div.innerHTML = `‚ùå Erro: ${data.message || "Desconhecido"}`;
          }
        } catch (error) {
          div.className = "resultado erro";
          div.innerHTML = `‚ùå Erro: ${error.message}`;
        }
      }

      async function testarMentores() {
        const div = document.getElementById("resultado-mentores");
        div.style.display = "block";
        div.className = "resultado info";
        div.innerHTML = "‚è≥ Contando...";

        try {
          const response = await fetch("debug-limite.php");
          const text = await response.text();

          // Procurar por "Mentores cadastrados" no HTML
          const match = text.match(/Mentores atuais: (\d+)/);
          if (match) {
            const total = match[1];
            div.className = "resultado sucesso";
            div.innerHTML = `‚úÖ Total de mentores: <strong>${total}</strong>`;
          } else {
            div.className = "resultado erro";
            div.innerHTML = `‚ùå N√£o foi poss√≠vel ler a resposta`;
          }
        } catch (error) {
          div.className = "resultado erro";
          div.innerHTML = `‚ùå Erro: ${error.message}`;
        }
      }

      function testarListeners() {
        const div = document.getElementById("resultado-listeners");
        div.style.display = "block";

        const form = document.getElementById("form-mentor-novo");
        if (!form) {
          div.className = "resultado erro";
          div.innerHTML = `‚ùå Form 'form-mentor-novo' n√£o encontrado na p√°gina`;
          return;
        }

        // Verificar se h√° listener (n√£o √© poss√≠vel verificar diretamente, mas checamos estrutura)
        const temNome = !!document.getElementById("nome");
        const temFoto = !!document.getElementById("foto");
        const temEntrada = !!document.getElementById("input-entrada");

        if (temNome && temFoto && temEntrada) {
          div.className = "resultado sucesso";
          div.innerHTML = `‚úÖ FORM ESTRUTURA OK<br>
                Campo Nome: ${temNome ? "‚úÖ" : "‚ùå"}<br>
                Campo Foto: ${temFoto ? "‚úÖ" : "‚ùå"}<br>
                Campo Entrada: ${temEntrada ? "‚úÖ" : "‚ùå"}<br><br>
                <strong>Nota:</strong> Abra F12 ‚Üí Console para ver logs de clique no bot√£o "Enviar"`;
        } else {
          div.className = "resultado erro";
          div.innerHTML = `‚ùå Form faltando campos necess√°rios`;
        }
      }

      // Testes autom√°ticos ao carregar
      window.addEventListener("load", () => {
        console.log("=== P√ÅGINA DE TESTES CARREGADA ===");
        console.log("Clique em um bot√£o para testar");
      });
    </script>
  </body>
</html>
