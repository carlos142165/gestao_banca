<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Filtro OVER</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2d2d2d;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        h1 {
            color: #ffff00;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #1e1e1e;
            border-left: 3px solid #00ff00;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: #0a0a0a;
            border-radius: 3px;
        }
        .debug-btn {
            background: #00aa00;
            color: black;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
        }
        .debug-btn:hover {
            background: #00ff00;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #00ff00;
        }
        .warning {
            color: #ffaa00;
        }
        #logsContainer {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Filtro OVER</h1>
        
        <div class="section">
            <h2>üìã An√°lise do Problema</h2>
            <p><strong>üéØ O Problema:</strong> Quando clica em "+1 GOL", aparecem tanto "+1" quanto "+0.5" no modal.</p>
            <p><strong>üîç Poss√≠vel Causa:</strong> H√° <strong>m√∫ltiplos registros DIFERENTES</strong> no banco para o <strong>mesmo jogo</strong> na <strong>mesma data</strong>:</p>
            <ul>
                <li>Registro 1: Palmeiras x Santos | 2025-11-07 | "+1 ‚öΩGOL"</li>
                <li>Registro 2: Palmeiras x Santos | 2025-11-07 | "+0.5 ‚öΩGOL"</li>
            </ul>
            <p><strong>‚úÖ Solu√ß√£o Implementada:</strong> Quando h√° filtro de OVER, o backend <strong>deve rejeitar</strong> registros que n√£o correspondem ao OVER solicitado.</p>
            <p><strong>üß™ Como Testar:</strong></p>
            <ol>
                <li>Clique em "Ver L√≥gica de Filtro" para ver quais registros DEVEM ser inclu√≠dos</li>
                <li>Clique em "Ver Duplicatas no BD" para ver a estrutura de dados</li>
                <li>Clique em "Executar Teste" abaixo para chamar a API</li>
                <li>Compare o resultado com o esperado</li>
            </ol>
        </div>

        <div class="section">
            <h2>üß™ Ferramentas de Debug</h2>
            <button class="debug-btn" onclick="mostrarLogsRecentes()">üìã Mostrar Logs Recentes</button>
            <button class="debug-btn" onclick="limparLogs()">üóëÔ∏è Limpar Logs</button>
            <button class="debug-btn" onclick="window.open('teste-filtro-over-logica.php', '_blank')">üß¨ Ver L√≥gica de Filtro</button>
            <button class="debug-btn" onclick="window.open('verificar-duplicatas.php', '_blank')">üìä Ver Duplicatas no BD</button>
            <button class="debug-btn" onclick="testarAPI()">üîó Testar API Simples</button>
            <button class="debug-btn" onclick="abrirConsole()">üíª Abrir Console (F12)</button>
        </div>

        <div class="section">
            <h2>üìä O que Procurar nos Logs</h2>
            <div class="log-entry">
                <span class="success">‚úÖ Se FUNCIONAR (Esperado):</span>
                <div style="margin: 10px 0; padding: 10px; background: #1a3a1a;">
                    Ao clicar "+1 GOL" e chamar a API:<br/>
                    <code>total_time1: 1 ou 2 (contendo APENAS +1)</code><br/>
                    <code>total_time2: 1 ou 2 (contendo APENAS +1)</code><br/>
                    <code>filtro_ativado: true</code><br/>
                    <code>filtro_valor_over_solicitado: "1"</code><br/>
                    Logs: "[TIME1] ‚úÖ ACEITANDO" para registros com +1<br/>
                    Logs: "[TIME1] ‚ùå REJEITANDO" para registros com +0.5
                </div>
            </div>
            <div class="log-entry">
                <span class="error">‚ùå Se N√ÉO FUNCIONAR (Problema):</span>
                <div style="margin: 10px 0; padding: 10px; background: #3a1a1a;">
                    Se retornar AMBOS +1 E +0.5:<br/>
                    <code>total_time1: 2 (contendo +1 E +0.5 misturados)</code><br/>
                    Verificar:<br/>
                    ‚Ä¢ "FILTRO N√ÉO ATIVADO" = valorOver n√£o chegou<br/>
                    ‚Ä¢ "[TIME1] ‚úÖ ACEITANDO" aparece para AMBOS = valida√ß√£o incorreta<br/>
                    ‚Ä¢ Logs mostram compara√ß√£o: "1" vs "0.5" mas ambos aceitam
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìú √öltimos Logs</h2>
            <div id="logsContainer"></div>
        </div>

        <div class="section">
            <h2>üß¨ Teste de API Direto</h2>
            <div>
                <label>Time 1: <input type="text" id="time1Test" value="Palmeiras" style="color: black;"></label><br/>
                <label>Time 2: <input type="text" id="time2Test" value="Santos" style="color: black;"></label><br/>
                <label>Tipo: <select id="tipoTest" style="color: black;"><option>gols</option><option>cantos</option></select></label><br/>
                <label>Valor Over: <input type="text" id="valorOverTest" value="1" style="color: black;" placeholder="ex: 1 ou 0.5"></label><br/>
                <button class="debug-btn" onclick="testarAPIComParametros()">üöÄ Executar Teste</button>
            </div>
            <div id="apiResponse" style="margin-top: 15px; display: none;">
                <h3>Resposta da API:</h3>
                <pre id="apiResponseContent" style="background: #0a0a0a; padding: 10px; border-radius: 3px; overflow-x: auto;"></pre>
            </div>
        </div>
    </div>

    <script>
        async function mostrarLogsRecentes() {
            try {
                const response = await fetch('api/get-error-logs.php');
                const logs = await response.text();
                document.getElementById('logsContainer').innerHTML = '<pre style="white-space: pre-wrap; word-wrap: break-word;">' + escapeHtml(logs) + '</pre>';
            } catch (e) {
                document.getElementById('logsContainer').innerHTML = '<div class="error">Erro ao carregar logs: ' + e.message + '</div>';
            }
        }

        async function limparLogs() {
            try {
                const response = await fetch('api/clear-error-logs.php');
                alert('Logs limpos (se implementado)');
            } catch (e) {
                alert('Erro: ' + e.message);
            }
        }

        async function testarAPI() {
            const response = await fetch('debug-api-over.php');
            const data = await response.json();
            alert('Resultado:\n' + JSON.stringify(data, null, 2));
        }

        async function testarAPIComParametros() {
            const time1 = document.getElementById('time1Test').value;
            const time2 = document.getElementById('time2Test').value;
            const tipo = document.getElementById('tipoTest').value;
            const valorOver = document.getElementById('valorOverTest').value;

            console.log('üß™ Testando API com:', { time1, time2, tipo, valorOver });

            const response = await fetch('api/obter-historico-resultados.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    time1,
                    time2,
                    tipo,
                    limite: 10,
                    valorOver: valorOver || undefined
                })
            });

            const data = await response.json();
            console.log('üìä Resposta:', data);
            
            document.getElementById('apiResponse').style.display = 'block';
            document.getElementById('apiResponseContent').textContent = JSON.stringify(data, null, 2);
        }

        function abrirConsole() {
            console.log('üíª Console aberto! Verifique os logs aqui.');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
