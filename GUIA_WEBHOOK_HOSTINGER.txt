================================================================================
GUIA COMPLETO - CONFIGURAR WEBHOOK PARA HOSTINGER
================================================================================
Data: 10 de Novembro de 2025

PROBLEMA:
=========
O webhook do Telegram parou de enviar mensagens para o banco de dados na
Hostinger. Isso acontece quando:
  âŒ Config.php nÃ£o estÃ¡ em public_html
  âŒ Credenciais de banco erradas
  âŒ ConexÃ£o caiu e nÃ£o reconecta
  âŒ PermissÃµes de pasta erradas


SOLUÃ‡ÃƒO PROPOSTA:
=================
Criar um arquivo de configuraÃ§Ã£o SEPARADO em public_html que:
  âœ… Gerencia conexÃ£o com reconexÃ£o automÃ¡tica
  âœ… Valida saÃºde do webhook
  âœ… Registra erros em logs
  âœ… Testa conexÃ£o facilmente


ğŸ“‹ ARQUIVOS A USAR:
===================

1. webhook-diagnostico.php
   â””â”€ Teste rÃ¡pido de saÃºde do sistema
   â””â”€ Verifica banco, logs, permissÃµes
   â””â”€ Acesso: https://seusite.com/gestao/gestao_banca/webhook-diagnostico.php

2. config-webhook.php
   â””â”€ ConfiguraÃ§Ã£o centralizada do webhook
   â””â”€ Editar com suas credenciais
   â””â”€ FaÃ§a upload em: public_html/gestao/gestao_banca/

3. telegram-webhook.php (MODIFICADO)
   â””â”€ Agora tem reconexÃ£o automÃ¡tica
   â””â”€ Tenta reconectar se banco cair
   â””â”€ Funciona com config-webhook.php


âœ… PASSO A PASSO DE SETUP:
==========================

1ï¸âƒ£  PREPARAR ARQUIVO DE CONFIGURAÃ‡ÃƒO (local)

    â”œâ”€ Abra: config-webhook.php
    â”œâ”€ Edite as linhas:
    â”‚  â”œâ”€ DB_HOST: seu host de banco
    â”‚  â”œâ”€ DB_USER: seu usuÃ¡rio
    â”‚  â”œâ”€ DB_PASSWORD: sua senha
    â”‚  â”œâ”€ DB_NAME: nome do banco
    â”‚  â”œâ”€ TELEGRAM_BOT_TOKEN: seu token do bot
    â”‚  â””â”€ TELEGRAM_CHANNEL_ID: seu channel ID
    â”‚
    â””â”€ SALVE o arquivo

2ï¸âƒ£  FAZER UPLOAD PARA HOSTINGER (via FTP)

    â”œâ”€ Conectar ao servidor via FTP
    â”‚  â”œâ”€ Host: ftp.seusite.com.br
    â”‚  â”œâ”€ UsuÃ¡rio: seu_usuario_ftp
    â”‚  â””â”€ Senha: sua_senha_ftp
    â”‚
    â”œâ”€ Navegar atÃ©: public_html/gestao/gestao_banca/
    â”‚
    â”œâ”€ Upload dos arquivos:
    â”‚  â”œâ”€ config-webhook.php          (NOVO)
    â”‚  â”œâ”€ webhook-diagnostico.php     (NOVO)
    â”‚  â””â”€ api/telegram-webhook.php    (SUBSTITUIR)
    â”‚
    â””â”€ Definir permissÃµes:
       â”œâ”€ config-webhook.php: 644
       â”œâ”€ webhook-diagnostico.php: 644
       â”œâ”€ api/telegram-webhook.php: 644
       â””â”€ logs/ (pasta): 755

3ï¸âƒ£  TESTAR CONFIGURAÃ‡ÃƒO

    â”œâ”€ Abrir no navegador:
    â”‚  https://seusite.com/gestao/gestao_banca/webhook-diagnostico.php
    â”‚
    â”œâ”€ Verificar se vÃª:
    â”‚  â”œâ”€ âœ… Arquivo de configuraÃ§Ã£o ENCONTRADO
    â”‚  â”œâ”€ âœ… ConexÃ£o com banco OK
    â”‚  â”œâ”€ âœ… Tabela 'bote' EXISTE
    â”‚  â”œâ”€ âœ… Pasta 'logs' com permissÃ£o
    â”‚  â””â”€ Nenhuma linha em vermelho
    â”‚
    â””â”€ Se houver erro em vermelho, ver seÃ§Ã£o SOLUÃ‡ÃƒO DE PROBLEMAS

4ï¸âƒ£  TESTAR WEBHOOK

    â”œâ”€ Enviar mensagem no Telegram
    â”‚  â””â”€ "Oportunidade!" ou "Resultado"
    â”‚
    â”œâ”€ Voltar para pÃ¡gina de diagnÃ³stico
    â”‚  https://seusite.com/gestao/gestao_banca/webhook-diagnostico.php
    â”‚
    â”œâ”€ Verificar "Ãšltimas linhas do log"
    â”‚  â””â”€ Deve mostrar sua mensagem processada
    â”‚
    â””â”€ Verificar no banco de dados
       â””â”€ Nova aposta ou resultado deve estar lÃ¡ âœ…


ğŸ” SOLUÃ‡ÃƒO DE PROBLEMAS:
========================

PROBLEMA: "Arquivo de configuraÃ§Ã£o nÃ£o encontrado"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CAUSAS:
  âŒ config-webhook.php nÃ£o foi uploaded
  âŒ EstÃ¡ em pasta errada
  âŒ Nome do arquivo estÃ¡ errado

  SOLUÃ‡ÃƒO:
  âœ… Fazer upload de config-webhook.php
  âœ… Verificar se estÃ¡ em: /public_html/gestao/gestao_banca/
  âœ… Conferir se o nome estÃ¡ exatamente: config-webhook.php (sem espaÃ§os)

PROBLEMA: "ConexÃ£o com banco recusada"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CAUSAS:
  âŒ Credenciais erradas em config-webhook.php
  âŒ Host do banco incorreto
  âŒ Banco offline

  SOLUÃ‡ÃƒO:
  âœ… Abrir config-webhook.php
  âœ… Verificar credenciais em seu painel Hostinger
  âœ… Testar conexÃ£o com phpMyAdmin
  âœ… Editar config-webhook.php com dados corretos
  âœ… Fazer re-upload

PROBLEMA: "Pasta de logs sem permissÃ£o"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CAUSAS:
  âŒ Pasta logs nÃ£o tem permissÃ£o 755
  âŒ Arquivo de log nÃ£o Ã© writable

  SOLUÃ‡ÃƒO:
  âœ… Conectar via FTP
  âœ… Clicar direito na pasta "logs"
  âœ… Propriedades â†’ PermissÃµes
  âœ… Definir como 755
  âœ… Aplicar para pasta e arquivos dentro

PROBLEMA: "Nenhuma aposta chega no banco"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CAUSAS:
  âŒ Webhook nÃ£o estÃ¡ recebendo mensagens
  âŒ Banco desconectou apÃ³s primeira mensagem
  âŒ URL do webhook incorreta no Telegram

  SOLUÃ‡ÃƒO:
  âœ… Verificar URL do webhook no Telegram Bot
     https://seusite.com/gestao/gestao_banca/api/telegram-webhook.php
  âœ… Verificar logs para ver se mensagem chegou
  âœ… Fazer upload de config-webhook.php para reconexÃ£o automÃ¡tica
  âœ… Testar uma mensagem
  âœ… Verificar logs

PROBLEMA: "Logs vazios ou nÃ£o criados"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CAUSAS:
  âŒ Pasta logs nÃ£o existe
  âŒ Sem permissÃ£o de escrita
  âŒ Webhook com erro antes de criar log

  SOLUÃ‡ÃƒO:
  âœ… Via FTP, criar pasta "logs" em /public_html/gestao/gestao_banca/
  âœ… Definir permissÃ£o 755
  âœ… Fazer upload do arquivo webhook-diagnostico.php
  âœ… Testar pÃ¡gina de diagnÃ³stico novamente


ğŸ“Š VERIFICAR CREDENCIAIS (HOSTINGER):
=====================================

1. Abrir painel Hostinger â†’ hPanel
2. Procurar: "Gerenciar Banco de Dados"
3. Verificar:
   â”œâ”€ Host (DB_HOST)
   â”‚  â””â”€ Geralmente: localhost ou 127.0.0.1
   â”‚
   â”œâ”€ UsuÃ¡rio (DB_USER)
   â”‚  â””â”€ ComeÃ§a com: u_xxxxx
   â”‚
   â”œâ”€ Senha (DB_PASSWORD)
   â”‚  â””â”€ A senha que vocÃª configurou
   â”‚
   â””â”€ Nome do Banco (DB_NAME)
      â””â”€ Geralmente igual ou similar ao usuÃ¡rio

4. Editar config-webhook.php com esses dados
5. Fazer upload novamente


ğŸ” SEGURANÃ‡A:
=============

âš ï¸  NUNCA deixe credenciais em cÃ³digo aberto!

RECOMENDAÃ‡Ã•ES:
  âœ… config-webhook.php sÃ³ em produÃ§Ã£o (public_html)
  âœ… NÃ£o colocar em versionamento de cÃ³digo
  âœ… PermissÃ£o 644 no arquivo
  âœ… Considerar usar variÃ¡veis de ambiente em futuro

PROTEÃ‡ÃƒO:
  âœ… O webhook-diagnostico.php nÃ£o expÃµe credenciais
  âœ… Logs nÃ£o mostram senhas
  âœ… Apenas host, usuÃ¡rio e banco sÃ£o vistos


ğŸš€ RESUMO VISUAL:
=================

Antes (âŒ Sem reconexÃ£o):
  Mensagem chega â†’ Banco desconecta â†’ Mensagem perdida âŒ

Depois (âœ… Com reconexÃ£o):
  Mensagem chega â†’ Banco desconecta â†’ Reconecta â†’ Salva âœ…
  Acontece automaticamente via config-webhook.php


ğŸ“ CHECKLIST FINAL:
===================

Antes de considerar concluÃ­do:

  [ ] Download dos 3 arquivos localmente
  [ ] EdiÃ§Ã£o de config-webhook.php com credenciais
  [ ] Upload via FTP dos 3 arquivos
  [ ] DefiniÃ§Ã£o de permissÃµes (644 / 755)
  [ ] Teste de diagnÃ³stico (sem erros vermelhos)
  [ ] Envio de mensagem no Telegram
  [ ] ConfirmaÃ§Ã£o no banco que foi salva
  [ ] VerificaÃ§Ã£o de logs

Se tudo verde: âœ… WEBHOOK FUNCIONAL!


ğŸ“ PRÃ“XIMOS PASSOS:
===================

1. Monitorar logs nos prÃ³ximos dias
2. Se houver reconexÃµes frequentes, investigar:
   â”œâ”€ Timeout do servidor
   â”œâ”€ Limite de conexÃµes simultÃ¢neas
   â””â”€ Contatar suporte Hostinger

3. Considerar melhorias futuras:
   â”œâ”€ Cache de conexÃ£o
   â”œâ”€ Queue de mensagens
   â””â”€ Alertas via email em caso de erro


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Desenvolvido: 10 de Novembro de 2025
VersÃ£o: 1.0
Status: Pronto para ProduÃ§Ã£o
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
