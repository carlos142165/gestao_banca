<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üî• TESTE CR√çTICO - Filtro OVER</title>
    <style>
        * { font-family: monospace; }
        body { background: #1e1e1e; color: #00ff00; padding: 20px; margin: 0; }
        .container { background: #2d2d2d; padding: 20px; border-radius: 5px; max-width: 1000px; margin: auto; }
        h1 { color: #ffff00; border-bottom: 2px solid #00ff00; padding-bottom: 10px; }
        h2 { color: #00aaff; margin-top: 30px; border-bottom: 1px solid #00aaff; }
        button { background: #00aa00; color: black; padding: 15px 25px; margin: 10px; cursor: pointer; font-weight: bold; border: none; border-radius: 5px; font-size: 14px; }
        button:hover { background: #00ff00; }
        pre { background: #0a0a0a; padding: 15px; border-radius: 3px; overflow-x: auto; border-left: 3px solid #00ff00; max-height: 400px; overflow-y: auto; }
        .success { border-left-color: #00ff00; }
        .error { border-left-color: #ff0000; }
        .warning { border-left-color: #ffaa00; }
        .title-test { background: #00aa00; color: black; padding: 10px; margin: 10px 0; border-radius: 3px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• TESTE CR√çTICO - Filtro de OVER</h1>
        
        <h2>üìù Instru√ß√µes</h2>
        <p>Clique em cada bot√£o abaixo para ver o que est√° acontecendo. Os resultados mostram como o sistema est√° funcionando.</p>

        <h2>Teste 1: Verificar se Filtro √© Ativado</h2>
        <div class="title-test">Enviando valorOver="1"</div>
        <button onclick="testeUm()">‚ñ∂ Teste 1 - Verificar Ativa√ß√£o do Filtro</button>
        <pre id="teste1" class="success"></pre>

        <h2>Teste 2: Comparar com Banco (SEM Filtro)</h2>
        <div class="title-test">Sem valorOver - mostra TODOS</div>
        <button onclick="testeDois()">‚ñ∂ Teste 2 - SEM Filtro (TODOS os resultados)</button>
        <pre id="teste2" class="warning"></pre>

        <h2>Teste 3: Comparar com Banco (COM Filtro = 1)</h2>
        <div class="title-test">Com valorOver="1" - deve filtrar</div>
        <button onclick="testeTres()">‚ñ∂ Teste 3 - COM Filtro (+1)</button>
        <pre id="teste3" class="success"></pre>

        <h2>Teste 4: Comparar com Banco (COM Filtro = 0.5)</h2>
        <div class="title-test">Com valorOver="0.5" - deve filtrar diferente</div>
        <button onclick="testeQuatro()">‚ñ∂ Teste 4 - COM Filtro (+0.5)</button>
        <pre id="teste4" class="success"></pre>

        <h2>üéØ O que Esperar</h2>
        <div class="warning" style="padding: 15px; margin: 10px 0; background: #333;">
            <strong>Teste 1:</strong> Deve mostrar "filtro_ativado": true<br/>
            <strong>Teste 2:</strong> Deve mostrar MUITOS resultados (5+)<br/>
            <strong>Teste 3:</strong> Deve mostrar MENOS resultados (apenas +1)<br/>
            <strong>Teste 4:</strong> Deve mostrar DIFERENTES resultados (apenas +0.5)<br/>
            <strong>Importante:</strong> Teste 3 + Teste 4 = Teste 2 (mesma quantidade total)
        </div>
    </div>

    <script>
        async function testeUm() {
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            console.log("TESTE 1: Enviando valorOver='1' para verificar ativa√ß√£o do filtro");
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            
            const payload = {
                time1: "Palmeiras",
                time2: "Santos",
                tipo: "gols",
                limite: 10,
                valorOver: "1"
            };
            
            console.log("üì§ Payload enviado:", payload);
            
            try {
                const response = await fetch('api/obter-historico-resultados.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                console.log("üìä Resposta completa:", data);
                
                // An√°lise
                const resultado = {
                    filtro_ativado: data.filtro_ativado,
                    filtro_valor_solicitado: data.filtro_valor_over_solicitado,
                    total_results: (data.total_time1 || 0) + (data.total_time2 || 0),
                    time1_count: data.total_time1,
                    time2_count: data.total_time2
                };
                
                if (data.filtro_ativado) {
                    console.log("‚úÖ SUCESSO: Filtro FOI ATIVADO");
                } else {
                    console.log("‚ùå PROBLEMA: Filtro N√ÉO foi ativado");
                }
                
                document.getElementById('teste1').textContent = 
                    "RESULTADO:\n" + JSON.stringify(resultado, null, 2) +
                    "\n\nFILTRO_DEBUG:\n" + JSON.stringify(data.filtro_debug, null, 2) +
                    "\n\nDados retornados:\nTime1: " + data.total_time1 + " resultados\nTime2: " + data.total_time2 + " resultados";
                    
            } catch (e) {
                console.error("‚ùå Erro:", e);
                document.getElementById('teste1').textContent = "ERRO: " + e.message;
            }
        }

        async function testeDois() {
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            console.log("TESTE 2: Enviando SEM valorOver (deve retornar TODOS)");
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            
            const payload = {
                time1: "Palmeiras",
                time2: "Santos",
                tipo: "gols",
                limite: 10
                // Sem valorOver!
            };
            
            console.log("üì§ Payload enviado:", payload);
            
            try {
                const response = await fetch('api/obter-historico-resultados.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                const total = (data.total_time1 || 0) + (data.total_time2 || 0);
                
                console.log("üìä Total de resultados retornados:", total);
                
                let detalhe = "Total: " + total + " resultados\n\n";
                detalhe += "Time1 (" + data.total_time1 + "):\n";
                if (data.time1_historico) {
                    data.time1_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado})\n`;
                    });
                }
                
                detalhe += "\nTime2 (" + data.total_time2 + "):\n";
                if (data.time2_historico) {
                    data.time2_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado})\n`;
                    });
                }
                
                document.getElementById('teste2').textContent = detalhe;
                
            } catch (e) {
                console.error("‚ùå Erro:", e);
                document.getElementById('teste2').textContent = "ERRO: " + e.message;
            }
        }

        async function testeTres() {
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            console.log("TESTE 3: Enviando valorOver='1' (deve filtrar)");
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            
            const payload = {
                time1: "Palmeiras",
                time2: "Santos",
                tipo: "gols",
                limite: 10,
                valorOver: "1"
            };
            
            console.log("üì§ Payload enviado:", payload);
            
            try {
                const response = await fetch('api/obter-historico-resultados.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                const total = (data.total_time1 || 0) + (data.total_time2 || 0);
                
                console.log("üìä Total de resultados retornados (com filtro +1):", total);
                
                let detalhe = "Total: " + total + " resultados (esperado: MENOS que Teste 2)\n\n";
                detalhe += "Time1 (" + data.total_time1 + "):\n";
                if (data.time1_historico) {
                    data.time1_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado}) [OVER=${r.valor_over}]\n`;
                    });
                }
                
                detalhe += "\nTime2 (" + data.total_time2 + "):\n";
                if (data.time2_historico) {
                    data.time2_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado}) [OVER=${r.valor_over}]\n`;
                    });
                }
                
                document.getElementById('teste3').textContent = detalhe;
                
            } catch (e) {
                console.error("‚ùå Erro:", e);
                document.getElementById('teste3').textContent = "ERRO: " + e.message;
            }
        }

        async function testeQuatro() {
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            console.log("TESTE 4: Enviando valorOver='0.5' (deve filtrar diferente)");
            console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
            
            const payload = {
                time1: "Palmeiras",
                time2: "Santos",
                tipo: "gols",
                limite: 10,
                valorOver: "0.5"
            };
            
            console.log("üì§ Payload enviado:", payload);
            
            try {
                const response = await fetch('api/obter-historico-resultados.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                const total = (data.total_time1 || 0) + (data.total_time2 || 0);
                
                console.log("üìä Total de resultados retornados (com filtro +0.5):", total);
                
                let detalhe = "Total: " + total + " resultados (esperado: MENOS que Teste 2, DIFERENTE de Teste 3)\n\n";
                detalhe += "Time1 (" + data.total_time1 + "):\n";
                if (data.time1_historico) {
                    data.time1_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado}) [OVER=${r.valor_over}]\n`;
                    });
                }
                
                detalhe += "\nTime2 (" + data.total_time2 + "):\n";
                if (data.time2_historico) {
                    data.time2_historico.forEach((r, i) => {
                        detalhe += `  ${i+1}. ${r.titulo} (${r.resultado}) [OVER=${r.valor_over}]\n`;
                    });
                }
                
                document.getElementById('teste4').textContent = detalhe;
                
            } catch (e) {
                console.error("‚ùå Erro:", e);
                document.getElementById('teste4').textContent = "ERRO: " + e.message;
            }
        }
    </script>
</body>
</html>
